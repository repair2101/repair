# Generated by Django 4.1.2 on 2023-01-23 15:22

from django.db import migrations

from django.contrib.auth.models import User
from django.contrib.auth.models import Group

from datetime import datetime, timedelta
import time

def beginning(apps, schema_editor):
    
    # Суперпользователь id-1
    user = User.objects.create_superuser(username='root',
    first_name = 'Суперпользователь',
    email='root@mail.ru',
    password='SsNn5678+-@', 
    last_login=datetime.now())
    print("Суперпользователь создан")
    
    # Группа менеджеров
    managers = Group.objects.get_or_create(name = 'Managers')
    managers = Group.objects.get(name='Managers')
    print("Группа менеджеров создана")
    
    # ѕользователь с ролью менеджера id2
    user = User.objects.create_user(username='manager', password='Ss0066+-', email='manager@mail.ru', first_name='ћенеджер', last_name='', last_login=datetime.now())
    managers.user_set.add(user)
    print("Менеджер добавлен в группу менеджеров")

    ###### Сотрудник #####
    Employee = apps.get_model("crud", "Employee")
    
    employee = Employee()
    employee.login = "admin"
    employee.password = "admin"
    employee.name = "Администратор"
    employee.email = "admin@mail.ru"
    employee.admin = 1
    employee.manager = 0
    employee.save()
    
    employee = Employee()
    employee.login = "manager"
    employee.password = "manager"
    employee.name = "Менеджер"
    employee.email = "manager@mail.ru"
    employee.admin = 0
    employee.manager = 1
    employee.save()
    
    employee = Employee()
    employee.login = "master1"
    employee.password = "master1"
    employee.name = "Мастер 1"
    employee.email = "master1@mail.ru"
    employee.admin = 0
    employee.manager = 0
    employee.save()
    
    employee = Employee()
    employee.login = "master2"
    employee.password = "master2"
    employee.name = "Мастер 2"
    employee.email = "master2@mail.ru"
    employee.admin = 0
    employee.manager = 0
    employee.save()
    
    employee = Employee()
    employee.login = "master3"
    employee.password = "master3"
    employee.name = "Мастер 3"
    employee.email = "master3@mail.ru"
    employee.admin = 0
    employee.manager = 0
    employee.save()
    
    employee = Employee()
    employee.login = "master4"
    employee.password = "master4"
    employee.name = "Мастер 1"
    employee.email = "master4@mail.ru"
    employee.admin = 0
    employee.manager = 0
    employee.save()

    print("Employee, ok")

    ###### Заявки и их движение #####
    Request = apps.get_model("crud", "Request")
    Stage = apps.get_model("crud", "Stage")
    
    request = Request()
    request.dater = datetime.now()
    request.customer = "Нурахунов Рамиль"
    request.address = "ул. Ак. Сатпаева, 243-12"
    request.phone = "+7-701-111-222"
    request.problem = "Не работает принтер HP 1005"
    request.cost = 0
    request.save()

    stage = Stage()
    stage.request_id = 1
    stage.dates = request.dater
    stage.details = "Назначена на мастера"
    stage.employee_id = 3
    stage.save()
    
    request = Request()
    request.dater = datetime.now()
    request.customer = "Бояринцева Ксения"
    request.address = "ул. Ак. Чокина, 8-121"
    request.phone = "+7-701-111-3333"
    request.problem = "Не работает монитор Samsung"
    request.cost = 0
    request.save()

    stage = Stage()
    stage.request_id = 2
    stage.dates = request.dater
    stage.details = "Назначена на мастера"
    stage.employee_id = 4
    stage.save()
    
    request = Request()
    request.dater = datetime.now()
    request.customer = "Дадаханов Инамжан"
    request.address = "ул. Торайгырова, 6-102"
    request.phone = "+7-701-111-4444"
    request.problem = "Не включается системный блок"
    request.cost = 0
    request.save()

    stage = Stage()
    stage.request_id = 3
    stage.dates = request.dater
    stage.details = "Назначена на мастера"
    stage.employee_id = 5
    stage.save()
    
    request = Request()
    request.dater = datetime.now()
    request.customer = "Артюшенко Илья"
    request.address = "ул. Карбаева, 100-71"
    request.phone = "+7-701-111-5555"
    request.problem = "Не работает копировальный аппарат Xerox"
    request.cost = 0
    request.save()

    stage = Stage()
    stage.request_id = 4
    stage.dates = request.dater
    stage.details = "Назначена на мастера"
    stage.employee_id = 6
    stage.save()
    
    print("Request, ok")
    print("Stage, ok")

class Migration(migrations.Migration):

    dependencies = [
        ('crud', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(beginning),  
    ]

